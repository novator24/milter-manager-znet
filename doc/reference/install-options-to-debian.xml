<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE refentry 
  PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
  "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd">
<refentry id="install-options-to-debian">
<refmeta>
  <refentrytitle role='top_of_page' id='install-options-to-debian.top_of_page'>Install to Debian (optional)</refentrytitle>
  <refmiscinfo>MILTER-MANAGER Library</refmiscinfo>
</refmeta>
<refnamediv>
  <refname>Install to Debian (optional)</refname>
  <refpurpose>How to install milter manager related softwares to Debian GNU/Linux</refpurpose>
</refnamediv>
<refsect1>
  <title>About this document</title>
  <para>
  This document describes how to install milter manager related softwares to Debian GNU/Linux. See 
  <link linkend='install-to-debian'>Install to Debian</link>
   for milter manager install information and 
  <link linkend='install'>Install</link>
   for general install information.
</para>
</refsect1>

<refsect1 id='install-options-to-debian.milter-manager-log-analyzer'>
  <title>Install milter-manager-log-analyzer</title>
  <para>milter-manager-log-analyzer is already installed because it is included in milter manager's package. We will configure Web server to browse graphs generated by milter-manager-log-analyzer.</para>
  <para>
  There are two ways to view generated graphs; (1) view them via a Web server at the same host and (2) view them via
  <ulink url='http://munin-monitoring.org/'>Munin</ulink>
   (and a Web server) at other host. If we already have Munin or exclusive system monitoring server, Munin is a better way. Otherwise, a Web server at the same host is a better way. 
  <footnote>
  <para>If we want to run Munin at the same host, we need a Web server.</para>
</footnote>
  
</para>
  <para>First, a way that a Web server in the same host will be explained, then a way that using Munin will be explained.</para>
  <refsect2>
  <title>Way 1: View via a Web server at the same host</title>
  <refsect3>
  <title>Install packages</title>
  <para>We use Apache as Web server.</para>
  <programlisting>% sudo aptitude -V -D -y install apache2</programlisting>
</refsect3>

  <refsect3>
  <title>Configure milter-manager-log-analyzer</title>
  <para>milter-manager-log-analyzer generates graphs into milter-manager user's home directory. (/var/lib/milter-manager/) We configure Web server to publish them at http://localhost/milter-manager-log/.</para>
  <programlisting>% sudo -u milter-manager mkdir -p ~milter-manager/public_html/log</programlisting>
  <para>We put /etc/apache2/conf.d/milter-manager-log with the following content:</para>
  <programlisting>Alias /milter-manager-log/ /var/lib/milter-manager/public_html/log/</programlisting>
  <para>We need to reload configuration after editing:</para>
  <programlisting>% sudo /etc/init.d/apache2 force-reload</programlisting>
  <para>Now, we can see graphs at http://localhost/milter-manager-log/.</para>
</refsect3>

</refsect2>

  <refsect2 id='install-options-to-debian.munin'>
  <title>Way 2: View via Munin at other host</title>
  <para>Next way is using Munin at other host.</para>
</refsect2>

  <refsect3>
  <title>Install packages</title>
  <para>We install milter-manager-munin-plugins package that provides statistics data collected by milter-manager-log-analyzer to Munin:</para>
  <programlisting>% sudo aptitude -V -D -y install milter-manager-munin-plugins</programlisting>
  <para>
  <emphasis>NOTE: We need to use databases created by milter-manager-log-analyzer bundled with milter manager 1.5.0 or later to provide statistics data to Munin. If we have databases that are created by older milter-manager-log-analyzer, we need to remove ~milter-manager/public_html/log/. If we remove the directory, milter-manager-log-analyzer re-creates statistics databases 5 minutes later.</emphasis>
  
</para>
</refsect3>

  <refsect3>
  <title>Configure munin-node</title>
  <para>Munin-node should accept accesses from Munin server. If Munin server is 192.168.1.254, we need to append the following lines to /etc/munin/munin-node.conf:</para>
  <para>/etc/munin/munin-node.conf:</para>
  <programlisting>allow ^192\.168\.1\.254$</programlisting>
  <para>We need to restart munin-node to apply our configuration:</para>
  <programlisting>% sudo /usr/sbin/service munin-node restart</programlisting>
</refsect3>

  <refsect3>
  <title>Configure Munin server</title>
  <para>Works in this section at system monitor server. We assume that system monitor server works on Debian GNU/Linux.</para>
  <para>First, we install munin and Apache:</para>
  <programlisting>monitoring-server% sudo aptitude -V -D -y install munin apache2</programlisting>
  <para>We add our mail server that works munin-node to munin's monitor target. We assume that mail server has the following configuration:</para>
  <variablelist>
  <varlistentry>
  <term id='install-options-to-debian.Host'>Host name</term>
  <listitem>
  <para>mail.example.com</para>
</listitem>
</varlistentry>
  <varlistentry>
  <term id='install-options-to-debian.IP'>IP address</term>
  <listitem>
  <para>192.168.1.2</para>
</listitem>
</varlistentry>
</variablelist>
  <para>We need to add the following lines to /etc/munin/munin.conf to add the mail server:</para>
  <para>/etc/munin/munin.conf:</para>
  <programlisting>[mail.example.com]
    address 192.168.1.2
    use_node_name yes</programlisting>
  <para>We will be able to view graphs at http://monitoring-server/munin/ 5 minutes later.</para>
</refsect3>

</refsect1>

<refsect1>
  <title>Conclusion</title>
  <para>
  We can confirm milter's effect visually by milter-manager-log-analyzer. If we use Postfix as MTA, we can compare with
  <ulink url='http://mailgraph.schweikert.ch/'>Mailgraph</ulink>
  's graphs to confirm milter's effect. We can use graphs generated by milter-manager-log-analyzer effectively when we are trying out a milter.
</para>
</refsect1>
</refentry>
